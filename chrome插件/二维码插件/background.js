var mid="anything2qrcode-context-menu-1",mid2="anything2qrcode-context-menu-2",extensionId=chrome.i18n.getMessage("@@extension_id"),imageDatas={},createContextMenus=function(){chrome.contextMenus.create({id:mid,title:chrome.i18n.getMessage("generate"),contexts:["page","frame","selection","link","image","video","audio"],documentUrlPatterns:["http://*/*","https://*/*","ftp://*/*"]}),chrome.contextMenus.create({id:mid2,title:chrome.i18n.getMessage("decode"),contexts:["image"],documentUrlPatterns:["http://*/*","https://*/*","ftp://*/*"]})};chrome.runtime.onInstalled.addListener(function(){createContextMenus()}),chrome.contextMenus.onClicked.addListener(function(a,b){if(a.menuItemId===mid){var c=!0;a.linkUrl&&(c=!1,chrome.tabs.sendMessage(b.id,{theTextToQRCode:a.linkUrl,type:"link"})),a.selectionText&&""!=a.selectionText.trim()&&(c=!1,chrome.tabs.sendMessage(b.id,{theTextToQRCode:a.selectionText,type:"text"})),a.srcUrl&&(c=!1,chrome.tabs.sendMessage(b.id,{theTextToQRCode:a.srcUrl,type:"media"})),c&&a.pageUrl&&chrome.tabs.sendMessage(b.id,{theTextToQRCode:a.pageUrl,type:"page"})}else a.menuItemId==mid2&&a.srcUrl&&(qrcode.callback=function(a){chrome.tabs.sendMessage(b.id,{decodeResult:a})},qrcode.decode(a.srcUrl))});var pageActionTitle=chrome.i18n.getMessage("pageActionTitle");chrome.tabs.onUpdated.addListener(function(a,b,c){-1==c.url.indexOf(extensionId)&&(chrome.pageAction.setTitle({tabId:a,title:pageActionTitle+c.url}),chrome.pageAction.setPopup({tabId:a,popup:"pageaction.html?text="+encodeURIComponent(c.url)}),chrome.pageAction.show(a))}),chrome.tabs.onRemoved.addListener(function(a){delete imageDatas["t"+a]}),chrome.pageAction.onClicked.addListener(function(a){chrome.runtime.sendMessage({theTextToQRCode:a.url,type:"location"})}),chrome.runtime.onMessage.addListener(function(a,b,c){a.download_img&&chrome.tabs.create({url:"download.html"},function(b){imageDatas["t"+b.id]=a.download_img}),"content-script-init"==a&&createContextMenus(),c({received:!0})});